/**
 *
 * @module     local_coursetransfer
 * @copyright  2023 Proyecto UNIMOODLE
 * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>
 * @author     3IPUNT <contacte@tresipunt.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_coursetransfer/origin_restore_course_step5",["jquery","core/str","core/ajax","core/templates"],(function($,Str,Ajax,Templates){let SERVICES_RESTORE_COURSE_STEP5="local_coursetransfer_new_origin_restore_course_step5",ACTIONS_RESTORE='[data-action="execute-restore"]';function restoreCourseStep5(region,site){this.node=$(region),this.restoreid=$("[data-restoreid]").attr("data-restoreid"),this.targetid=$("[data-targetid]").attr("data-targetid"),this.site=site,this.node.find(ACTIONS_RESTORE).on("click",this.clickNext.bind(this));let sessiondata=JSON.parse(sessionStorage.getItem($("[data-course-sessionStorageId]").attr("data-course-sessionStorageId"))),sections=sessiondata.course.sections;$('input[type="checkbox"]').prop("disabled",!0),$('input[type="radio"]').prop("disabled",!0),sections.forEach((function(section){if(section.selected){let sectionrow=$("#section-"+section.sectionid);sectionrow.addClass("selected"),sectionrow[0].children[0].children[0].children[0].checked=!0}section.activities.forEach((function(activity){if(activity.selected){let activityrow=$("#activity-"+activity.cmid);activityrow.addClass("selected"),activityrow[0].children[0].children[0].checked=!0}}))})),sessiondata.course.configuration.forEach((function(config){config.selected&&$("#"+config.name).prop("checked",!0)}))}return restoreCourseStep5.prototype.clickNext=function(e){this.node.find(ACTIONS_RESTORE).prop("disabled",!0);let self=this,alertbox=this.node.find(".alert"),siteurl=this.site,courseid=this.restoreid,targetid=this.targetid,sessiondata=JSON.parse(sessionStorage.getItem($("[data-course-sessionStorageId]").attr("data-course-sessionStorageId"))),configuration={};sessiondata.course.configuration.forEach((function(config){configuration[config.name]=config.selected}));let config={target_merge_activities:!1,target_remove_activities:!1,target_remove_groups:!1,target_remove_enrols:!1};configuration.target_merge_activities&&(config.target_merge_activities=configuration.target_merge_activities),configuration.target_remove_activities&&(config.target_remove_activities=configuration.target_remove_activities),configuration.target_remove_groups&&(config.target_remove_groups=configuration.target_remove_groups),configuration.target_remove_enrols&&(config.target_remove_enrols=configuration.target_remove_enrols),configuration.origin_enrol_users&&(config.origin_enrol_users=configuration.origin_enrol_users),configuration.origin_remove_course&&(config.origin_remove_course=configuration.origin_remove_course);const request={methodname:SERVICES_RESTORE_COURSE_STEP5,args:{siteurl:siteurl,courseid:courseid,targetid:targetid,configuration:config,sections:sessiondata.course.sections}};console.log(request),Ajax.call([request])[0].done((function(response){if(response.success)window.location.href=response.data.nexturl;else if(response.success){let errors=[{code:"100031",msg:"error_not_controlled"}];self.renderErrors(errors,alertbox)}else self.renderErrors(response.errors,alertbox)})).fail((function(fail){let errors=[{code:"100032",msg:fail.message}];self.renderErrors(errors,alertbox)}))},restoreCourseStep5.prototype.renderErrors=function(errors,alertbox){let errorString="";alertbox.removeClass("hidden"),errors.forEach((error=>{errorString+="Error ("+error.code+"): "+error.msg+"<br>"})),alertbox.append(errorString)},restoreCourseStep5.prototype.node=null,{initRestoreCourseStep5:function(region,site){return new restoreCourseStep5(region,site)}}}));

//# sourceMappingURL=origin_restore_course_step5.min.js.map